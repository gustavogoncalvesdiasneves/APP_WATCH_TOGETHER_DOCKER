<!DOCTYPE html>
<html>
<head>
    <title>Synced Video Player</title>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <video id="video" controls style="width: 100%;">
        <source src="/example-video.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <script>
        var socket = io();
        var video = document.getElementById('video');
        // var clientIdInput = document.getElementById('clientId');
        var lastSentTime = 0;

        // function setClientId() {
        //     var clientId = clientIdInput.value;
        //     socket.emit('set client id', clientId);
        // }

        // video.addEventListener('click', function() {
        //     if (video.paused) {
        //         video.play();
        //     }
        // });

        // Verificar se o elemento de vídeo foi encontrado no DOM
        if (video) {
            // Adicionar ouvintes de evento somente se o elemento de vídeo existir
            // Enviar mensagem quando o vídeo é reproduzido
            video.addEventListener('play', function() {
                console.log('Play event triggered');
                socket.emit('video sync', { action: 'play', currentTime: video.currentTime});
            });

            // Enviar mensagem quando o vídeo é pausado
            video.addEventListener('pause', function() {
                console.log('Pause event triggered');
                socket.emit('video sync', { action: 'pause', currentTime: video.currentTime});
            });

            // Enviar mensagem quando o vídeo é avançado ou retrocedido
            video.addEventListener('seeked', function() {
                console.log('Seek event triggered');
                var currentTime = video.currentTime;
                if (Math.abs(currentTime - lastSentTime) > 0.5) { // Only send if there's a significant change
                    console.log('Sending seek message:', currentTime);
                    socket.emit('video sync', { action: 'seek', currentTime: currentTime});
                    lastSentTime = currentTime;
                }
            });

            // Receber mensagens de sincronização do servidor
            socket.on('video sync', function(data) {
                console.log('Received video sync message:', data);
                // if (data.clientId === clientIdInput.value) {
                    switch(data.action) {
                        case 'play':
                            // Sincronizar a reprodução e a posição de reprodução
                            console.log('Play action received');
                            video.currentTime = data.currentTime;
                            video.play();
                            break;
                        case 'pause':
                            // Sincronizar a pausa e a posição de reprodução
                            console.log('Pause action received');
                            video.currentTime = data.currentTime;
                            video.pause();
                            break;
                        case 'seek':
                            // Sincronizar a posição de reprodução com base na mensagem de busca recebida
                            console.log('Seek action received');
                            video.currentTime = data.currentTime;
                            break;
                    }
                // }
            });
        }
    </script>
</body>
</html>
